# Входной контроль по дисциплине «Технологии разработки распределённых вычислений»

## Постановка задачи
Написать программу на объектно-ориентированном языке, в которой необходимо реализовать импорт данных из ненормализованной структуры таблиц базы данных  в нормализованную, а также выгрузку в шаблоны табличного процессора.
Также для выполнения задания требовалось определить предметную область и спроектировать таблицы.

## Описание предметной области
Была выбрана предметная область "Курсы дополнительного образования в ПГНИУ". Предметная область предполагает создание базы данных для хранения информации о курсах предоставляемых ПГНИУ, о преподавателях ведущих эти курсы, их контактную информацию, расписания проведения занятий и информацию о месте проведения этих занятий.

## Проектирование и нормализация таблиц
В ненормализованной форме получилась следующая таблица:

![UNF](img/lab0_UNF.png?raw=true)

Далее таблица была пошагово приведена к 3ей нормальной форме:

Первая нормальная форма:


![UNF](img/lab0_1NF.png?raw=true)

Вторая нормальная форма:

![UNF](img/lab0_2NF.png?raw=true)

Третья нормальная форма:

![UNF](img/lab0_3NF.png?raw=true)

Настольная БД Firebird была создана с помощью утилиты isql, входящей в состав клиентской части Firebird.
Также была создана БД Postgres со схемой с названием "psu-courses".
Таблицы созданы с помощью скриптов, расположенных в директории sql.
unf.sql - скрипт, который использовался для создания ненормализованной таблицы в БД Firebird.
3nf.sql - скрипт, который использовался для создания нормализованных таблиц в БД Postgres.
## Описание приложения
Репозиторий содержит программный код приложения, реализующего поставленную задачу. Приложение написано на языке Java 8. Для сборки приложения используется maven. Для работы с базами данных используется Jooq. Для создания таблицы в формате .xsl используется библиотека Apache POI.
Приложение умеет выполнять 2 функции:
1. Импорт данных из ненормализованной структуры таблиц базы данных  в нормализованную.
2. Выгрузка данных в элетронную таблицу (.xsl).

В качестве настольной базы данных для хранения ненормализованной таблицы используется Firebird, в качестве базы данных для хранения таблиц в нормализованной форме используется Postgres.
После запуска приложение позволяет выбрать, какую функцию необходимо выполнить. 

## Сборка приложения
Сборка осуществляется с помощью maven. В ходе сборки с помощью плагина jooq-codegen генерируются и включаются в состав приложения классы отражающие таблицы в базах данных. В результате получается приложение в виде .jar файла, который запускается с помощью JRE. 

## Описание алгоритмов работы функций
### Импорт данных из одной БД в другую (из Firebird в Postgres)
Алгоритм выполняется, если пользователь выберет в программе функцию под номером 1.
Сначала выполняется select запрос в БД, в результате которого формируется список строк (сущностей).
Далее по отдельности обрабатывается каждая строка по следующему принципу:

1. Сначала отбираются поля, которые могут храниться в той нормализованной таблице, в которой нет внешних ключей на другие таблицы. В БД по данной таблице производится поиск строк, содержащих поля с теми же значениями.

2.1. Если найдена строка, значения полей которой полностью совпадают с искомыми, то сохраняется её идентификатор (значение первичного ключа).

2.2. Если такая строка не найдена, то создаётся новая строка с этими значениями. Идентификатор созданной строки сохраняется.

3.0. Далее из исходной строки отбираются поля, которые могут храниться в тех нормализованных таблицах, в которых присутствуют внешние ключи на таблицы, для которых уже сохранён идентификатор какой-либо строки. К этим отобранным полям применяются шаги 2.1. и 2.2.

И так до тех пор, пока не останется необработанных полей. Идентификаторы сохраняются для того, чтобы использовать их как внешние ключи для добавляемых строк в шаге 2.1.

Все запросы к БД осуществляются с помощью Jooq.
### Выгрузка данных из нормализованных таблиц в формат .xls.
Алгоритм выполняется, если пользователь выберет в программе функцию под номером 2.

Алгоритм выполняется без использования внешних скриптов и приложений. Для создания и наполнения электронной таблицы используется библиотека Apache POI.
Алгоритм заключается в последовательном создании объектов и их заполнении. Объекты соответсвуют таким элементам электронной таблицы как страницы, строки, столбцы, ячейки. По завершению заполнения рядом с приложением создаётся файл ExportedData.xls со всей информацией из нормализованных таблиц в БД Postgres.
